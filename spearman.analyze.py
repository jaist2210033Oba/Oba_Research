import pandas as pd
from scipy.stats import spearmanr

# ==== データ (質問文のまま) ====
data = {
    "記憶心理学": {
        "survey": pd.DataFrame({
            "主題理解": [3.357142857, 3.285714286, 3.214285714, 3.642857143, 3.857142857, 4.142857143],
            "関連性":   [3.615384615, 3.142857143, 3.571428571, 3.857142857, 4.214285714, 3.928571429],
            "有用性":   [3.642857143, 3.142857143, 3.285714286, 3.714285714, 3.785714286, 4.285714286],
            "既知性":   [2.571428571, 3.5, 2.357142857, 3, 3.428571429, 3.5]
        }, index=["Word2Vec1","Word2Vec2","Word2Vec3","積集合1","積集合2","積集合3"]),
        "machine": pd.DataFrame({
            "入次数": [0.464537635, 0.064234863, 0.796148364, 1, 0, 0.366466243],
            "BERT":   [0.52975048, 0, 0.364683301, 1, 0.892514395, 0.547024952],
            "平均":   [0.635419982, 0.021411621, 0.504314781, 0.748826291, 0.318631559, 0.637830398],
            "TF-IDF": [0.911971831, 0, 0.352112676, 0.246478873, 0.063380282, 1]
        }, index=["Word2Vec1","Word2Vec2","Word2Vec3","積集合1","積集合2","積集合3"])
    },
    "著作権創作": {
        "survey": pd.DataFrame({
            "主題理解": [4.266666667, 4.733333333, 4.866666667, 4.533333333, 3.8, 3.6],
            "関連性":   [4.4, 4.666666667, 5.066666667, 4.466666667, 4.066666667, 3.8],
            "有用性":   [4.4, 4.6, 4.933333333, 4.533333333, 4, 3.733333333],
            "既知性":   [2.4, 2.666666667, 2.333333333, 2.733333333, 2.8, 2.333333333]
        }, index=["Word2Vec1","Word2Vec2","Word2Vec3","積集合1","積集合2","積集合3"]),
        "machine": pd.DataFrame({
            "入次数": [0, 1, 0.545335333, 0.332902215, 0.098129725, 0.233023379],
            "BERT":   [1, 0.984344423, 0.849315068, 0.542074364, 0.111545988, 0],
            "平均":   [0.666666667, 0.730609139, 0.534044465, 0.29165886, 0.136785328, 0.202391013],
            "TF-IDF": [1, 0.207482993, 0.207482993, 0, 0.200680272, 0.37414966]
        }, index=["Word2Vec1","Word2Vec2","Word2Vec3","積集合1","積集合2","積集合3"])
    },
    "環境問題海面上昇": {
        "survey": pd.DataFrame({
            "主題理解": [3.8, 3.9, 4.2, 4.6, 4.7, 4.3],
            "関連性":   [4.4, 3.8, 4.1, 4.4, 4.6, 4.5],
            "有用性":   [4.2, 4, 4.3, 4.2, 4.7, 4.5],
            "既知性":   [2.2, 2.3, 2.1, 1.8, 1.5, 1.9]
        }, index=["Word2Vec1","Word2Vec2","Word2Vec3","積集合1","積集合2","積集合3"]),
        "machine": pd.DataFrame({
            "入次数": [0.254514287, 0.112561061, 0, 0.228264904, 0.12903692, 1],
            "BERT":   [0.596577017, 0, 0.841075795, 0.755501222, 1, 0.968215159],
            "平均":   [0.556471429, 0.037520354, 0.290192967, 0.492518315, 0.709678973, 0.705761161],
            "TF-IDF": [0.818322981, 0, 0.029503106, 0.49378882, 1, 0.149068323]
        }, index=["Word2Vec1","Word2Vec2","Word2Vec3","積集合1","積集合2","積集合3"])
    }
}

# ==== 対応関係 ====
mapping = {
    "主題理解": "入次数",
    "関連性": "BERT",
    "有用性": "平均",
    "既知性": "TF-IDF"
}

# ==== テーマ別 ====
for theme, dfs in data.items():
    survey = dfs["survey"]
    machine = dfs["machine"]
    print(f"=== {theme} ===")
    for survey_key, machine_key in mapping.items():
        rho, p = spearmanr(survey[survey_key], machine[machine_key])
        print(f"{survey_key} vs {machine_key}: Spearman ρ = {rho:.3f}, p = {p:.4f}")
    print()

# ==== 全テーマ統合 ====
survey_all = pd.concat([dfs["survey"] for dfs in data.values()])
machine_all = pd.concat([dfs["machine"] for dfs in data.values()])

print("=== 全テーマ統合 ===")
for survey_key, machine_key in mapping.items():
    rho, p = spearmanr(survey_all[survey_key], machine_all[machine_key])
    print(f"{survey_key} vs {machine_key}: Spearman ρ = {rho:.3f}, p = {p:.4f}")
